"use strict";var SearchWidget=function(){function e(e){var t=[];jQuery.each(e,function(e,r){var c=jQuery('<li class="group"><span class="title" /><ul class="sites" /></li>');jQuery(".title",c).text(e);var a=[];jQuery.each(r,function(e,t){var r=jQuery('<li class="item"><span>Search <b class="title" /> for <b class="query" /></span></li>');r.data("url",t.url),jQuery(".title",r).text(t.name),jQuery(".query",r).text(s.searchInput.val()),a.push(r)}),jQuery(".sites",c).append(a),t.push(c)}),s.searchSelectors.append(t),jQuery(".item:first",s.searchSelectors).addClass("selected")}var s;return{settings:{searchForm:jQuery("#search"),searchInput:jQuery(".autosearch"),searchSelectors:jQuery(".searchselectors"),jsonURL:"search.json",blurDelay:200},init:function(){s=this.settings,jQuery.getJSON(s.jsonURL,function(s){e(s)}),this.bindUIActions()},bindUIActions:function(){var e,t,r=s.searchSelectors,c=0;s.searchForm.on("submit",function(e){e.preventDefault(),SearchWidget.startSearch()}),s.searchInput.focus().on("keyup focus",function(){""!=s.searchInput.val()?s.searchSelectors.filter(".hidden").removeClass("hidden"):s.searchSelectors.addClass("hidden"),s.searchSelectors.find(".item .query").text(s.searchInput.val())}).on("keydown",function(s){switch(e=r.find(".item"),t=r.find(".selected"),s.keyCode){case 40:t.removeClass("selected"),c=(c+1)%e.length,t=e.eq(c).addClass("selected");break;case 38:t.removeClass("selected"),c=(c-1)%e.length,t=e.eq(c).addClass("selected")}}),jQuery(document).on("click",function(e){!jQuery(e.target).closest(s.searchSelectors).length&&jQuery(e.target).not(s.searchInput).length&&s.searchSelectors.not(".hidden")&&s.searchSelectors.addClass("hidden")}),s.searchSelectors.on("click",".item span",function(e){s.searchSelectors.find(".selected").removeClass("selected"),jQuery(this).parent().addClass("selected"),SearchWidget.startSearch()})},startSearch:function(){var e=jQuery(".selected",s.searchSelectors);window.location=e.data("url").replace("%s",s.searchInput.val())}}}();!function(){SearchWidget.init()}();